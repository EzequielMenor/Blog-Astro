---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro'; // Ajusta la ruta a tu Layout si es diferente

export async function getStaticPaths() {
	const blogEntries = await getCollection('blog');

	return blogEntries.map((entry) => {
		return {
			params: { slug: entry.slug.split('/') },
		};
	});
}

const { slug } = Astro.params;
const slugToFind = Array.isArray(slug) ? slug.join('/') : slug;

const entry = await getEntry('blog', slugToFind);

if (!entry) {
	return new Response('Post no encontrado.', {
		status: 404,
		headers: {
			'Content-Type': 'text/plain; charset=utf-8',
		},
	});
}

const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
	<article class='prose lg:prose-xl mx-auto py-8 px-4'>
		<h1 class='text-4xl font-bold mb-4'>{entry.data.title}</h1>
		<p class='text-gray-600 text-sm mb-6'>
			Publicado el: {entry.data.pubDate.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
			por {entry.data.author}
		</p>
		{entry.data.heroImage && <img src={entry.data.heroImage} alt={entry.data.title} class='w-full h-auto object-cover rounded-lg mb-6 max-h-96' />}
		<Content />

		{
			entry.data.tags && entry.data.tags.length > 0 && (
				<div class='mt-8'>
					<h3 class='text-xl font-semibold mb-2'>Etiquetas:</h3>
					<div class='flex flex-wrap gap-2'>
						{entry.data.tags.map((tag) => (
							<span class='bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800'>{tag}</span>
						))}
					</div>
				</div>
			)
		}
	</article>
</Layout>
